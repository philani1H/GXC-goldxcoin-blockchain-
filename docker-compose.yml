version: '3.8'

services:
  gxc-blockchain:
    build: .
    container_name: gxc-blockchain
    ports:
      - "18332:18332"  # Blockchain RPC
      - "8080:8080"    # REST API
      - "8081:8081"    # WebSocket
      - "3000:3000"    # Explorer
      - "3001:3001"    # Forum
      - "3333:3333"    # General Pool Stratum
      - "3334:3334"    # GPU Pool Stratum
      - "3335:3335"    # ASIC Pool Stratum
      - "5000:5000"    # Wallet API
      - "6000:6000"    # General Pool Dashboard
      - "6001:6001"    # GPU Pool Dashboard
      - "6002:6002"    # ASIC Pool Dashboard
    volumes:
      - gxc-data:/app/gxc_data
      - gxc-logs:/app/logs
      - gxc-miners:/app/miners/installers
    restart: unless-stopped
    environment:
      - BLOCKCHAIN_NODE_URL=http://localhost:18332
      - DATABASE_PATH=/app/gxc_data/blockchain.db
      - PYTHONUNBUFFERED=1
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  gxc-data:
    driver: local
  gxc-logs:
    driver: local
  gxc-miners:
    driver: local
