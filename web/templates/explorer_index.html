<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GXC Blockchain Explorer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        .bg-gxc { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .text-gxc { color: #667eea; }
        .card-hover:hover { transform: translateY(-5px); transition: all 0.3s ease; }
        .address-link { font-family: 'Courier New', monospace; }
        .hash-text { font-family: 'Courier New', monospace; word-break: break-all; }
        .stats-card { border-left: 4px solid #667eea; }
        .live-indicator { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-gxc">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <i class="fas fa-cube me-2"></i>GXC Explorer
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="fas fa-circle text-success live-indicator me-1"></i>Live
                </span>
            </div>
        </div>
    </nav>

    <!-- Search Bar -->
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <form action="/search" method="GET">
                            <div class="input-group">
                                <input type="text" class="form-control form-control-lg" 
                                       name="q" placeholder="Search by address, transaction hash, or block number...">
                                <button class="btn btn-primary" type="submit">
                                    <i class="fas fa-search"></i> Search
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Network Statistics -->
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h5 class="card-title text-muted">Total Blocks</h5>
                        <h2 class="text-gxc">{{ "{:,}".format(stats.total_blocks) }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h5 class="card-title text-muted">Transactions</h5>
                        <h2 class="text-gxc">{{ "{:,}".format(stats.total_transactions) }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h5 class="card-title text-muted">Addresses</h5>
                        <h2 class="text-gxc">{{ "{:,}".format(stats.total_addresses) }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h5 class="card-title text-muted">Total Supply</h5>
                        <h2 class="text-gxc">{{ "{:,.0f}".format(stats.total_supply) }} GXC</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-4">
        <div class="row">
            <!-- Recent Blocks -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="mb-0">
                            <i class="fas fa-cubes text-gxc me-2"></i>Recent Blocks
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Block</th>
                                        <th>Age</th>
                                        <th>Txns</th>
                                        <th>Miner</th>
                                        <th>Type</th>
                                    </tr>
                                </thead>
                                <tbody id="blocks-table">
                                    {% for block in blocks %}
                                    <tr>
                                        <td>
                                            <a href="/block/{{ block.number }}" class="text-decoration-none">
                                                {{ block.number }}
                                            </a>
                                        </td>
                                        <td class="text-muted small">
                                            <script>
                                                document.write(timeAgo('{{ block.timestamp }}'));
                                            </script>
                                        </td>
                                        <td>
                                            <span class="badge bg-secondary">{{ block.tx_count }}</span>
                                        </td>
                                        <td>
                                            <a href="/address/{{ block.miner }}" class="address-link text-decoration-none">
                                                {{ block.miner[:10] }}...
                                            </a>
                                        </td>
                                        <td>
                                            {% if block.consensus_type == 'pow' %}
                                                <span class="badge bg-warning">PoW</span>
                                            {% else %}
                                                <span class="badge bg-info">PoS</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer bg-white text-center">
                        <a href="/blocks" class="btn btn-outline-primary">View All Blocks</a>
                    </div>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="mb-0">
                            <i class="fas fa-exchange-alt text-gxc me-2"></i>Recent Transactions
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Hash</th>
                                        <th>From</th>
                                        <th>To</th>
                                        <th>Value</th>
                                        <th>Age</th>
                                    </tr>
                                </thead>
                                <tbody id="transactions-table">
                                    {% for tx in transactions %}
                                    <tr>
                                        <td>
                                            <a href="/tx/{{ tx.hash }}" class="hash-text text-decoration-none">
                                                {{ tx.hash[:12] }}...
                                            </a>
                                        </td>
                                        <td>
                                            <a href="/address/{{ tx.from }}" class="address-link text-decoration-none">
                                                {{ tx.from[:8] }}...
                                            </a>
                                        </td>
                                        <td>
                                            {% if tx.to %}
                                                <a href="/address/{{ tx.to }}" class="address-link text-decoration-none">
                                                    {{ tx.to[:8] }}...
                                                </a>
                                            {% else %}
                                                <span class="text-muted">Contract Creation</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <span class="fw-bold">{{ "%.4f"|format(tx.value) }} GXC</span>
                                        </td>
                                        <td class="text-muted small">
                                            <script>
                                                document.write(timeAgo('{{ tx.timestamp }}'));
                                            </script>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer bg-white text-center">
                        <a href="/transactions" class="btn btn-outline-primary">View All Transactions</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Live Updates Notification -->
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 1050">
        <div id="liveToast" class="toast hide" role="alert">
            <div class="toast-header">
                <i class="fas fa-cube text-gxc me-2"></i>
                <strong class="me-auto">New Block</strong>
                <small class="text-muted">Live</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toast-body">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>GXC Blockchain Explorer</h5>
                    <p class="text-muted">Real-time blockchain data visualization for the GXC network.</p>
                </div>
                <div class="col-md-3">
                    <h6>Network</h6>
                    <ul class="list-unstyled">
                        <li><a href="/blocks" class="text-decoration-none text-light">Blocks</a></li>
                        <li><a href="/transactions" class="text-decoration-none text-light">Transactions</a></li>
                        <li><a href="/validators" class="text-decoration-none text-light">Validators</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>Tools</h6>
                    <ul class="list-unstyled">
                        <li><a href="/api/stats" class="text-decoration-none text-light">API</a></li>
                        <li><a href="/wallet" class="text-decoration-none text-light">Wallet</a></li>
                        <li><a href="/mining" class="text-decoration-none text-light">Mining</a></li>
                    </ul>
                </div>
            </div>
            <hr class="text-muted">
            <div class="text-center">
                <small>&copy; 2024 GXC Blockchain. All rights reserved.</small>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Time formatting function
        function timeAgo(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const seconds = Math.floor((now - time) / 1000);
            
            const intervals = [
                { label: 'year', seconds: 31536000 },
                { label: 'month', seconds: 2592000 },
                { label: 'day', seconds: 86400 },
                { label: 'hour', seconds: 3600 },
                { label: 'minute', seconds: 60 },
                { label: 'second', seconds: 1 }
            ];
            
            for (const interval of intervals) {
                const count = Math.floor(seconds / interval.seconds);
                if (count > 0) {
                    return `${count} ${interval.label}${count !== 1 ? 's' : ''} ago`;
                }
            }
            return 'just now';
        }

        // WebSocket connection for live updates
        const socket = io();
        
        socket.on('connect', function() {
            console.log('Connected to GXC Explorer');
        });
        
        socket.on('new_block', function(block) {
            // Show toast notification
            const toast = new bootstrap.Toast(document.getElementById('liveToast'));
            document.getElementById('toast-body').innerHTML = 
                `Block #${block.number} mined by ${block.miner.substring(0, 10)}... with ${block.transactions.length} transactions`;
            toast.show();
            
            // Update blocks table
            updateBlocksTable(block);
            
            // Update statistics
            updateStats();
        });
        
        function updateBlocksTable(newBlock) {
            const tbody = document.getElementById('blocks-table');
            const row = tbody.insertRow(0);
            
            row.innerHTML = `
                <td><a href="/block/${newBlock.number}" class="text-decoration-none">${newBlock.number}</a></td>
                <td class="text-muted small">just now</td>
                <td><span class="badge bg-secondary">${newBlock.transactions.length}</span></td>
                <td><a href="/address/${newBlock.miner}" class="address-link text-decoration-none">${newBlock.miner.substring(0, 10)}...</a></td>
                <td><span class="badge bg-warning">PoW</span></td>
            `;
            
            // Remove last row if we have more than 10
            if (tbody.rows.length > 10) {
                tbody.deleteRow(-1);
            }
        }
        
        function updateStats() {
            // Fetch updated statistics
            fetch('/api/stats')
                .then(response => response.json())
                .then(stats => {
                    // Update DOM elements with new stats
                    // This would update the statistics cards
                })
                .catch(error => console.error('Error fetching stats:', error));
        }
        
        // Auto-refresh every 30 seconds
        setInterval(function() {
            location.reload();
        }, 30000);
    </script>
</body>
</html>